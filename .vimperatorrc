echo "Now Loading..."

"自動フォーカス回避
set focuscontent
set showtabline=2

hi Hint z-index:5000; font-family:monospace; font-weight: bold; font-size:16px; color:white; background-color:#6666cc; border-color:ButtonShadow; border-width:0px; border-style:solid; padding:0px 1px 0px 1px; position:absolute;
" qmark go + ○ でアクセス
qmark c http://www.google.com/calendar/render
qmark g http://mail.google.com/
"" -------------------
"" キーマッピング
"" -------------------
"{{{
nnoremap j 8j
nnoremap k 8k
nnoremap J <C-d>
nnoremap K <C-u>
nnoremap rd :removetabsright<CR>
nnoremap ld :removetabsleft<CR>
" C-a,C-v,C-v,C-zを設定
inoremap <C-a> <C-v><C-a>
inoremap <C-z> <C-v><C-z>
inoremap <C-x> <C-v><C-x>
inoremap <C-c> <C-v><C-c>
inoremap <C-v> <C-v><C-v>
cnoremap <C-a> <C-v><C-a>
cnoremap <C-z> <C-v><C-z>
cnoremap <C-x> <C-v><C-x>
cnoremap <C-c> <C-v><C-c>
cnoremap <C-v> <C-v><C-v>
nnoremap <C-H> <BS>
cnoremap <C-i> <Tab>
cnoremap <C-n> <Tab>
cnoremap <C-p> <S-Tab>
cnoremap <C-j> <Tab>
cnoremap <C-k> <S-Tab>
cnoremap <C-l> <C-u>
cnoremap <C-;> <C-m>
cnoremap <C-d> <Down>
cnoremap <C-u> <Up>
cnoremap <C-b> <Left>
cnoremap <C-f> <Right>
cnoremap <C-r> <C-u>history 
imap <C-h> <BS>
imap <C-m> <CR>
imap <C-j> <Down>
imap <C-n> <Down>
imap <C-k> <Up>
imap <C-p> <Up>
imap <C-u> <Left>
imap <C-l> <Right>
" select next/previous tab
noremap <Right> gt
noremap <Left> gT
" <C-k>で検索に行かないようにする
map <C-k> <Nop>
" leaderキーの明示
let mapleader=','
" twitter.js + copy.js
nnoremap <Leader>a :copy titleAndBitURL<CR>:twitter : <C-v><C-v><C-a><C-Right> 
nnoremap <Leader>@ :twitter!@<CR>
nnoremap <Leader>f :twitter<CR>
" tomblrのreblog用
nnoremap <Leader>r :tombloo ReBlog\ -\ Tumblr<CR>
nnoremap <Leader>t :mb pinned-or-current-node\ |\ Tombloo::Reblog\ |\ clear-pin<CR>
vnoremap <Leader>q :tombloo Quote<CR>
" google検索
vnoremap <Leader>g y<normal>:tabopen google <C-v><C-v><CR>
nnoremap <Leader>g :gr<CR>
" Unhidden and hidden the menubar and the toolbar
noremap <A-Up> :set guioptions+=mT<CR>
noremap <A-Down> :set guioptions-=mT<CR>

noremap <A-T> :restart<CR>

" ,gaでweb-archiveのページにジャンプ
nnoremap <Leader>ga :mb location\ |\ web-archive\ |\ open<CR>
" ,hではてぶ
nnoremap <Leader>h :hb [
"}}}

" スクロールバーとタブ番号を非表示
set go=

" ページのアクセスキーを無効化
set! ui.key.generalAccessKey=0

" リンクのURIをコマンドラインに表示
set showstatuslinks=2

" Options
"" 検索キーワードのハイライト
set hlsearch
set runtimepath=~/.vimperator
set guioptions=nbr
set history=1000
set complete=ls
set wildoptions=auto
set suggestengines=google
set newtab=all
bmark -title="Twitter" -tags=keyword -keyword=tw http://twitter.com/%s
bmark -title="Twitter Search" -tags=keyword -keyword=ts http://search.twitter.com/search?q=%s
bmark -title="ふぁぼったー" -tags=keyword -keyword=fav http://favotter.matope.com/user.php?user=%s
bmark -title="Ustream" -tags=keyword -keyword=ust http://www.ustream.tv/channel/%s
bmark -title="ニコニコ動画" -tags=keyword -keyword=nico http://www.nicovideo.jp/watch/%s
bmark -title="Tumblr Dashboard" -tags=keyword -keyword=tumblr http://www.tumblr.com/dashboard/search/%s
bmark -title="FriendFeed Twitter(voidy21)" -tags=keyword -keyword=fftwitter http://friendfeed.com/search?q=from%3Avoidy21+service%3Atwitter+%s
bmark -title="FriendFeed Tumblr(voidy21)" -tags=keyword -keyword=fftumblr http://friendfeed.com/search?q=from%3Avoidy21+service%3Atumblr+%s
bmark -title="ニコニコ動画タグ検索" -tags=keyword -keyword=nicosearch http://www.nicovideo.jp/search/%s 
bmark -title="2ch内検索(Google)" -tags=keyword -keyword=2chsearch http://www.google.com/search?hl=ja&q=site%3A2ch.net+%s
bmark -title="Tumblrタグ検索" -tags=keyword -keyword=tumblrtag http://www.tumblr.com/tagged/%s
bmark -title="GoogleReader検索" -tags=keyword -keyword=googlereader http://www.google.co.jp/reader/view/#search/%s/

set defsearch=g

let g:hintsio="iO"
let g:tada_userId="voidy21"
let g:ldrc_intelligence_bind = "true"
let:g:ldrc_skip = "0.25"
colorscheme voidy21-color

""タブ追加ボタン消去
""http://fifnel.com/2009/03/15/2278/
style -name simple_tabs_container chrome://* <<EOM
.tabs-newtab-button {display: none !important;}
.tabs-container> stack {display: none;}
EOM

""ぶくまコメを表示
noremap v :viewSBMComments<CR>

autocmd LocationChange .* :fmapc
""Hatena Bookmark
""autocmd LocationChange ^http://b\.hatena\.ne\.jp/voidy21 :fmap j k o


"" Gmail/LDR/Fastladder/OpenFL上では新規タブをバックグラウンドで開く
autocmd LocationChange (?!https?://((mail|www)\.google\.(com|co\.jp)\/(mail|a|reader)\/|(reader\.livedoor\.com|fastladder\.com|0\.0\.0\.0\:3000)/reader/)|b\.hatena\.ne\.jp/) :set! browser.tabs.loadDivertedInBackground=false
autocmd LocationChange https?://((mail|www)\.google\.(com|co\.jp)\/(mail|a|reader)\/|(reader\.livedoor\.com|fastladder\.com|0\.0\.0\.0\:3000)/reader/|b\.hatena\.ne\.jp) :set! browser.tabs.loadDivertedInBackground=true

""LDR
autocmd LocationChange 'reader\.livedoor\.com/reader' :fmap j k s a p o v c <Space> <S-Space> z b < >

"" Google Reader
autocmd LocationChange 'www\.google\.co\.jp/reader' :fmap! -vkey j k n p m s t v A r S N P X O gh ga gs gt gu u / ?

"" Gmail
autocmd LocationChange mail\\.google\\.com/mail fmap! c / j k n p o u e x s r a # [ ] ? gi gs gt gd ga gc
autocmd LocationChange mail\\.google\\.com/mail/.*/[0-9a-f]+$ fmap! c / j,n k,p n,j p,k o u e x s r a # [ ] ? gi gs gt gd ga gc

""Google Calendar
autocmd LocationChange 'www\.google\.com/calendar/' :fmap! -vkey -event keydown t a d w m x c e <Del> / + q s ?

let g:maine_coon_default = "am"

" ステータスバーにfeedボタンを表示
" http://d.hatena.ne.jp/teramako/20071205/p1
js <<EOM
(function(){
 var feedPanel = document.createElement('statusbarpanel');
 var feedButton = document.getElementById('feed-button');
 feedPanel.setAttribute('id','feed-panel-clone');
 feedPanel.appendChild(feedButton.cloneNode(true));
 feedButton.parentNode.removeChild(feedButton);
 document.getElementById('status-bar').insertBefore(feedPanel,document.getElementById('security-button'));
})();
EOM


"""選択されている単語をmulti_requester.jsを使用して、英辞郎 on the Web で検索するためのキーマップです
"""@http://vimperator.g.hatena.ne.jp/snaka72/20090506/1241608109
js <<EOM
liberator.registerObserver("enter", function() {
  // for auto_word_select.js
  mappings.addUserMap(
    [modes.AUTO_WORD_SELECT],
    ["s"],
    "Translate selected word by multi_requester.js.",
    function() {
      // FIXME:
      // A present mode is preserved in the stack beforehand by the push() method
      // because it doesn't return to AUTO_WORD_SELECT mode before that when
      // returning from the OUTPUT_MULTILINE mode.
      modes.push(modes.AUTO_WORD_SELECT, null, true);

      var selText = content.getSelection().toString();
      var pattern = /[a-zA-Z]+/;
      selText = pattern.test(selText) ? pattern.exec(selText) : selText;
      events.feedkeys(":mr alc " + selText + "<CR>", true, true);
    }
  );
});
EOM
"""next linkのタブを新しく読み込むようにする
let g:nextlink_followlink = "true"

"" copy.js
js <<EOM
liberator.globalVariables.copy_templates = [
  { label: 'titleAndBitURL', value: '%TITLE% %bitURL%', custom: function() { 
        return '"' + buffer.title + '" ' + util.httpGet('http://bit.ly/api?url=' + encodeURIComponent(buffer.URL)).responseText;
  } },
  { label: 'titleAndURL',    value: '%TITLE% %URL%' },
  { label: 'title',          value: '%TITLE%' },
  { label: 'hatena',         value: '[%URL%:title=%TITLE%]' },
  { label: 'hatenacite',     value: '>%URL%:title=%TITLE%>\n%SEL%\n<<' },
  { label: 'markdown',       value: '[%SEL%](%URL% "%TITLE%")' },
  { label: 'htmlblockquote', value: '<blockquote cite="%URL%" title="%TITLE%">%HTMLSEL%</blockquote>' }
];
EOM
"" refcontrol.js
let g:refcontrol_enabled = "true"
js <<EOM
liberator.globalVariables.refcontrol = {
  '@DEFAULT'     : '@FORGE',        // @NORMAL, @FORGE, '', url
  'tumblr.com'   : '@FORGE',
  'del.icio.us'  : '@NORMAL',
  'fc2.com'      : '',
  'itmedia.co.jp': '@FORGE',
  'uploader.jp'  : '@NORMAL',
  'megalodon.jp' : '@NORMAL',
  'livedoor.com' : '@NORMAL',
};
EOM
" flash blockにヒントモード追加 (;z)
" http://d.hatena.ne.jp/mountain_dew/20090818/1250603912
js <<EOM
hints.addMode("z", "Enable a Flash object",
    function(elem){
        elem.focus();
        var e = content.document.createEvent('MouseEvents');
        e.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);
        elem.dispatchEvent( e );
    },
    function() "//xhtml:div[@title]"
);
EOM
javascript <<EOM
commands.addUserCommand(
  ['reblogall'],
  'reblog all tabs',
  function() {
    var itab=0;
    var ntab=tabs.count;
    liberator.echo(ntab);
    for(itab=0;itab<ntab;itab++){
      if(buffer.URL.toString().match(/\.tumblr/)) {
       //reblog and close
       liberator.echo('reblog');
       liberator.execute('tombloo ReBlog\ -\ Tumblr');
       liberator.execute('tabclose');
      }else{
        //next tab
        liberator.echo('no reblog');
        liberator.execute('tabnext');
      }
    }
  }
);
EOM
""素因数分解
""誰特
javascript <<EOM
commands.addUserCommand(
    ['fac[tor]'],
    'factorization in prime numbers',
    function(args) {
        let p=1,q,n=args[0],s="";
        while(++p && n-1){
            for(q=0;!(n%p);++q,n/=p);
            s+=q?(p+"^"+q+((n-1)?"*":"\n")):"";
        }
        liberator.echo(s);
    }
);
EOM
echo ".vimperatorrc sourced" 

